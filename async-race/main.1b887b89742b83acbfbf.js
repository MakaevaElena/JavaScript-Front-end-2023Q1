(()=>{"use strict";var e,t,a;!function(e){e.ID="id",e.WINS="wins",e.TYME="time",e.ASC="ASC",e.DESC="DESC",e.STARTED="started",e.STOPPED="stopped",e.DRIVE="drive"}(e||(e={})),function(e){e.POST="POST",e.DELETE="DELETE",e.PUT="PUT",e.PUTCH="PATCH"}(t||(t={})),function(e){e.GARAGE="garage",e.ENGINE="engine",e.WINNERS="winners"}(a||(a={}));class n{constructor(){this.url="http://127.0.0.1:3000",this.garage=`${this.url}/${a.GARAGE}`,this.engine=`${this.url}/${a.ENGINE}`,this.winners=`${this.url}/${a.WINNERS}`}getAllCars(){return fetch(`${this.garage}`).then((e=>e.json())).catch((()=>console.log("no cars")))}getCarsByPage(e,t=7){return fetch(`${this.garage}?_page=${e}&_limit=${t}`).then((e=>e.json()))}getCar(e){return fetch(`${this.garage}/${e}`).then((e=>e.json()))}createCar(e){return fetch(`${this.garage}`,{method:t.POST,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>e))}deleteCar(e){return fetch(`${this.garage}/${e}`,{method:t.DELETE}).then((e=>e.json()))}updateCar(e,a){return fetch(`${this.garage}/${e}`,{method:t.PUT,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json()))}startStopEngine(e,a){return fetch(`${this.engine}?id=${e}&status=${a}`,{method:t.PUTCH}).then((e=>e.json()))}driveCar(e,a){return fetch(`${this.engine}?id=${e}&status=${a}`,{method:t.PUTCH}).then((e=>e.ok?e.json():e.status))}getAllWinners(){return fetch(`${this.winners}`).then((e=>e.json())).catch((()=>console.log("no winners")))}getWinnersByPage(e,t,a,n){return fetch(`${this.winners}?_page=${e}&_limit=${t}&_sort=${a}&_order=${n}`).then((e=>e.json())).catch((()=>console.log("no winners")))}getWinner(e){return fetch(`${this.winners}/${e}`).then((e=>e.ok?e.json():e.status))}createWinner(e){return fetch(`${this.winners}`,{method:t.POST,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json()))}deleteWinner(e){return fetch(`${this.winners}/${e}`,{method:t.DELETE})}updateWinner(e,a){return fetch(`${this.winners}/${e}`,{method:t.PUT,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}}const s='\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"\n preserveAspectRatio="xMidYMid meet">\n<metadata>\nCreated by potrace 1.15, written by Peter Selinger 2001-2017\n</metadata>\n<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M3565 5336 c-106 -30 -101 -26 -108 -111 -4 -42 -9 -80 -12 -85 -6\n-10 -246 -105 -590 -234 -448 -167 -1052 -415 -1173 -483 -78 -43 -193 -91\n-250 -104 -23 -5 -98 -14 -165 -19 -67 -6 -167 -19 -222 -30 -154 -31 -340\n-49 -563 -57 l-203 -6 -43 -66 c-59 -91 -60 -95 -26 -130 37 -37 38 -65 3\n-150 -25 -62 -27 -78 -31 -256 l-4 -190 -38 -32 c-91 -78 -133 -209 -134 -418\n0 -194 11 -396 26 -482 13 -71 14 -74 72 -122 69 -58 130 -129 158 -184 64\n-126 534 -211 1384 -250 l92 -4 -6 119 c-6 142 8 256 49 383 112 352 394 622\n756 722 90 26 112 28 278 28 165 0 188 -2 278 -27 201 -56 361 -152 504 -302\n140 -145 222 -293 274 -492 21 -79 24 -109 23 -279 -1 -127 -6 -214 -16 -263\nl-15 -73 3006 7 c1653 4 3007 8 3009 9 1 1 -8 37 -20 81 -19 67 -22 105 -22\n259 -1 166 1 187 27 279 117 421 467 736 885 797 119 17 325 7 432 -21 239\n-63 453 -205 601 -399 70 -92 154 -267 185 -386 24 -88 27 -119 27 -260 1\n-116 -4 -181 -16 -234 -10 -41 -16 -75 -15 -76 2 -1 62 2 133 6 266 16 458 45\n525 79 48 24 97 81 127 146 l24 52 -16 157 c-15 152 -15 163 4 284 63 388 50\n680 -35 802 -134 193 -526 336 -1429 519 -737 149 -1322 209 -2033 210 -228 0\n-226 0 -347 85 -187 131 -1045 607 -1471 815 -383 187 -788 281 -1439 332\n-208 17 -1106 16 -1400 0 -121 -7 -314 -19 -430 -27 -302 -22 -286 -22 -341\n10 -140 81 -187 94 -269 71z m1885 -333 c6 -37 38 -238 71 -446 32 -209 66\n-422 75 -474 9 -52 15 -96 13 -97 -11 -9 -1699 29 -1951 44 -206 13 -417 36\n-485 54 -98 26 -198 119 -249 231 -35 75 -36 172 -5 255 17 45 30 61 68 86 83\n54 135 80 253 127 341 136 858 230 1460 267 269 16 270 16 511 18 l227 2 12\n-67z m630 47 c264 -18 777 -110 1029 -186 186 -56 445 -188 756 -387 211 -134\n274 -181 250 -185 -75 -12 -133 -50 -162 -106 -19 -35 -21 -136 -4 -179 l11\n-27 -907 2 -906 3 -59 160 c-110 302 -298 878 -298 916 0 6 95 2 290 -11z"/>\n<path d="M2633 3125 c-223 -40 -410 -141 -568 -306 -132 -138 -213 -283 -262\n-467 -22 -83 -26 -119 -26 -247 -1 -169 10 -236 65 -382 87 -230 271 -436 493\n-551 85 -44 178 -78 271 -98 107 -23 312 -23 419 1 392 84 699 375 802 761 23\n86 26 120 27 254 1 158 -5 199 -46 330 -98 310 -355 567 -668 669 -150 50\n-354 64 -507 36z m350 -301 c249 -56 457 -247 543 -499 25 -72 28 -95 28 -220\n1 -153 -15 -228 -74 -345 -94 -186 -283 -337 -485 -386 -96 -24 -268 -24 -360\n0 -320 84 -544 355 -562 681 -20 359 209 673 558 765 94 24 253 26 352 4z"/>\n<path d="M2600 2697 c-36 -13 -85 -36 -109 -51 l-44 -28 116 -115 c81 -82 120\n-114 131 -110 14 6 16 29 16 167 0 186 6 178 -110 137z"/>\n<path d="M2920 2561 c0 -139 2 -162 16 -168 11 -4 50 28 130 108 l115 114 -28\n22 c-34 28 -138 70 -193 79 l-40 7 0 -162z"/>\n<path d="M2282 2448 c-28 -36 -92 -191 -92 -225 0 -10 34 -13 165 -13 151 0\n165 1 165 18 0 15 -206 232 -221 232 -4 0 -11 -6 -17 -12z"/>\n<path d="M3222 2351 c-62 -59 -112 -115 -112 -124 0 -15 17 -17 165 -17 131 0\n165 3 165 13 0 40 -69 205 -95 227 -7 6 -48 -27 -123 -99z"/>\n<path d="M2781 2332 c-12 -22 11 -62 34 -62 8 0 21 10 29 22 20 28 4 58 -29\n58 -13 0 -29 -8 -34 -18z"/>\n<path d="M2749 2161 c-32 -33 -37 -67 -14 -110 29 -57 104 -64 151 -14 53 57\n9 153 -71 153 -27 0 -44 -8 -66 -29z"/>\n<path d="M2570 2125 c-26 -32 13 -81 48 -59 24 16 27 45 6 61 -23 17 -39 16\n-54 -2z"/>\n<path d="M3006 2124 c-20 -19 -20 -38 -2 -54 23 -19 61 -8 64 18 7 44 -32 67\n-62 36z"/>\n<path d="M2190 1975 c0 -29 41 -140 72 -194 l31 -53 117 117 c71 71 116 123\n113 131 -4 11 -40 14 -169 14 -141 0 -164 -2 -164 -15z"/>\n<path d="M3110 1972 c0 -9 51 -68 114 -131 l114 -114 31 54 c30 51 71 165 71\n195 0 11 -31 14 -165 14 -151 0 -165 -1 -165 -18z"/>\n<path d="M2780 1901 c-7 -15 -5 -24 8 -41 32 -40 85 -4 62 41 -14 25 -56 25\n-70 0z"/>\n<path d="M2562 1697 c-61 -62 -112 -115 -112 -119 0 -18 208 -108 249 -108 7\n0 11 54 11 164 0 140 -2 165 -16 170 -9 3 -16 6 -17 6 -1 0 -53 -51 -115 -113z"/>\n<path d="M2933 1803 c-15 -6 -19 -333 -4 -333 46 0 251 88 251 108 0 9 -223\n232 -230 231 -3 0 -11 -3 -17 -6z"/>\n<path d="M10700 3119 c-390 -84 -696 -376 -797 -759 -31 -117 -41 -292 -24\n-411 33 -227 150 -453 318 -609 267 -250 643 -344 993 -249 117 32 283 118\n380 196 487 396 518 1128 67 1560 -97 93 -166 140 -290 198 -137 64 -235 86\n-407 91 -120 3 -162 0 -240 -17z m445 -313 c238 -81 409 -258 486 -506 30 -96\n33 -289 5 -388 -110 -400 -513 -637 -911 -536 -149 38 -313 147 -402 267 -176\n238 -203 533 -71 797 34 69 60 103 138 180 77 78 111 104 181 139 129 65 207\n81 364 77 109 -3 143 -7 210 -30z"/>\n<path d="M10703 2700 c-54 -19 -153 -71 -153 -80 0 -3 51 -57 114 -119 80 -80\n119 -112 130 -108 14 5 16 29 16 167 l0 160 -27 -1 c-16 0 -52 -9 -80 -19z"/>\n<path d="M11020 2561 c0 -139 2 -162 16 -168 22 -8 247 216 234 232 -17 20\n-163 84 -207 91 l-43 7 0 -162z"/>\n<path d="M10366 2424 c-29 -44 -76 -165 -76 -194 0 -19 7 -20 165 -20 126 0\n165 3 165 13 0 7 -51 63 -114 126 l-114 114 -26 -39z"/>\n<path d="M11313 2348 c-61 -62 -109 -119 -106 -125 6 -15 333 -19 333 -4 0 45\n-88 241 -108 241 -4 0 -57 -51 -119 -112z"/>\n<path d="M10882 2338 c-17 -17 -15 -32 7 -52 16 -14 23 -15 41 -6 31 17 24 64\n-10 68 -14 2 -31 -3 -38 -10z"/>\n<path d="M10846 2159 c-68 -81 17 -194 110 -144 89 48 56 175 -46 175 -30 0\n-44 -6 -64 -31z"/>\n<path d="M10670 2126 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n-54 2z"/>\n<path d="M11106 2127 c-21 -16 -18 -45 7 -61 37 -23 77 35 41 61 -10 7 -21 13\n-24 13 -3 0 -14 -6 -24 -13z"/>\n<path d="M10290 1970 c0 -29 43 -141 74 -195 l28 -48 116 116 c81 81 113 120\n109 131 -6 14 -29 16 -167 16 -152 0 -160 -1 -160 -20z"/>\n<path d="M11207 1978 c-3 -7 47 -66 111 -130 l116 -118 27 43 c27 44 79 177\n79 203 0 12 -28 14 -164 14 -122 0 -166 -3 -169 -12z"/>\n<path d="M10881 1901 c-14 -25 -5 -48 20 -56 27 -9 51 13 47 44 -4 34 -51 43\n-67 12z"/>\n<path d="M10662 1697 c-61 -62 -112 -115 -112 -119 0 -20 201 -108 247 -108\n10 0 13 34 13 164 0 140 -2 165 -16 170 -9 3 -16 6 -17 6 -1 0 -53 -51 -115\n-113z"/>\n<path d="M11033 1803 c-10 -3 -13 -47 -13 -169 0 -90 4 -164 8 -164 36 0 186\n61 239 98 16 10 -216 242 -234 235z"/>\n</g>\n</svg>\n';var i,r,o,h,c,l,E,d,T,u,g,p;!function(e){e[e.RESET=0]="RESET",e[e.RACE=1]="RACE",e[e.FINISH=2]="FINISH",e[e.ARRAIVED=3]="ARRAIVED"}(i||(i={}));class m{createTagElement(e,t,a=""){const n=document.createElement(e);return n.classList.add(...t),n.innerHTML=a||"",n}}!function(e){e.MAIN="main",e.HEADER="header",e.HEADER_SECOND="h2",e.HEADER_THIRD="h3",e.BLOCK="div",e.BUTTON="button",e.INPUT="input",e.FORM="form"}(r||(r={})),function(e){e.APP="app"}(o||(o={})),function(e){e.SELECT_BUTTON="select-button",e.REMOVE_BUTTON="remove-button",e.CAR_TOP="car-top",e.CAR_BOTTOM="car-bottom",e.START_BUTTON="start-button",e.STOP_BUTTON="stop-button",e.CAR_BOTTOM_BUTTONS="car-bottom-buttons",e.CAR="car",e.CAR_BLOCK="car-block",e.CAR_NAME="car-name",e.FLAG="flag",e.SVG="svg g"}(h||(h={})),function(e){e.BUTTON="button",e.DISABLED_BUTTON="disabled-button",e.SHOW="show",e.HIDE="hide"}(c||(c={})),function(e){e.HEADER="header",e.HEADER_BUTTONS="header-buttons",e.TO_GARAGE="to-garage",e.TO_WINNERS="to-winners"}(l||(l={})),function(e){e.FORM="form",e.CREATE_NAME="create-name",e.UPDATE_NAME="update-name",e.CREATE_COLOR="create-color",e.UPDATE_COLOR="update-color",e.BUTTON_CREATE="button-create",e.BUTTON_UPDATE="button-update",e.BUTTON_RACE="button-race",e.BUTTON_RESET="button-reset",e.GENERATE_CARS="generate-cars",e.WINNER_POPUP="winner-popup",e.GROW="grow",e.WINNER_MESSAGE="winner-message"}(E||(E={})),function(e){e.GARAGE="garage",e.RACE_ROAD="race-road",e.CAR_LIST="cars-list"}(d||(d={})),function(e){e.WINNERS="winners",e.WINNERS_TABLE="winners-table",e.TABLE_HEADER_NUMBER="table-header-number",e.TABLE_HEADER="table-header",e.TABLE_HEADER_CAR="table-header-car",e.TABLE_HEADER_NAME="table-header-name",e.TABLE_HEADER_WINS="table-header-wins",e.TABLE_HEADER_TIME="table-header-time",e.WINNER_ROW="winner-row",e.WINNER_NUM="winner-Num",e.CELL="cell",e.WINNER_WINS="winner-wins",e.WINNER_TIME="winner-time",e.WINNER_CAR="winner-car",e.WINNER_NAME="winner-name"}(T||(T={})),function(e){e.PAGINATION="pagination",e.PAGE_BUTTON="page-button"}(u||(u={})),function(e){e.ID="id",e.TYPE="type",e.VALUE="value",e.FILL="fill"}(g||(g={})),function(e){e.IS_GARAGE="isGarage",e.ID="id",e.CURRENT_PAGE="currentPage",e.NAME="name",e.CURRENT_WINNERS_PAGE="currentWinnersPage"}(p||(p={}));class A extends m{constructor(e,t,a,o){super(),this.selectButton=this.createTagElement(r.BUTTON,[h.SELECT_BUTTON,c.BUTTON],"<h3>select</h3>"),this.removeButton=this.createTagElement(r.BUTTON,[h.REMOVE_BUTTON,c.BUTTON],"<h3>remove</h3>"),this.carTop=this.createTagElement(r.BLOCK,[h.CAR_TOP]),this.carBottom=this.createTagElement(r.BLOCK,[h.CAR_BOTTOM]),this.startButton=this.createTagElement(r.BUTTON,[h.START_BUTTON,c.BUTTON],"<h3>A</h3>"),this.stopButton=this.createTagElement(r.BUTTON,[h.STOP_BUTTON,c.BUTTON,c.DISABLED_BUTTON],"<h3>B</h3>"),this.carBottomButtons=this.createTagElement(r.BLOCK,[h.CAR_BOTTOM_BUTTONS]),this.car=this.createTagElement(r.BLOCK,[h.CAR],s),this.api=new n,this.observer=o,this.garageView=a,this.formView=t,this.carData=e,this.createTop(this.carData),this.createBottom(this.carData),this.createCar(e),this.updateCar(e),this.deleteCar(e),o?.subscribe(i.RESET,this.stopEngine.bind(this))}createCarBlock(e){const t=this.createTagElement(r.BLOCK,[h.CAR_BLOCK]);t.append(this.carTop,this.carBottom),e.append(t)}createTop(e){const t=this.createTagElement(r.BLOCK,[h.CAR_NAME],`<h3>${e.name}</h3>`);this.carTop.append(this.selectButton,this.removeButton,t)}createBottom(e){const t=this.createTagElement(r.BLOCK,[h.FLAG]);this.stopButton.disabled=!0,this.startButton.addEventListener("click",(()=>this.startEngine(e.id))),this.stopButton.addEventListener("click",(()=>this.stopEngine(e.id))),this.carBottomButtons.append(this.startButton,this.stopButton),this.carBottom.append(this.carBottomButtons,t)}createCar(e){const t=this.car.querySelector(h.SVG);t&&t.setAttribute(g.FILL,`${e.color}`),this.carBottom.append(this.car)}updateCar(e){this.selectButton.addEventListener("click",(()=>{localStorage.setItem(p.ID,e.id.toString()),localStorage.setItem(p.NAME,e.name),this.formView.setItemName(e.name)}))}deleteCar(e){this.removeButton.addEventListener("click",(t=>{t.preventDefault(),this.api.deleteCar(e.id).then((()=>{this.garageView.createRaceRoad(),this.api.deleteWinner(e.id).then((()=>this.api.deleteWinner(e.id)))}))}))}startEngine(t){let a;a=t?+t:this.carData.id,this.startButton.disabled=!0,this.startButton.classList.add(c.DISABLED_BUTTON),this.stopButton.disabled=!1,this.stopButton.classList.remove(c.DISABLED_BUTTON),this.api.startStopEngine(+a,e.STARTED).then((e=>{this.driveCar(+a,e.distance/e.velocity)}))}stopEngine(t){let a;a=t?+t:this.carData.id,this.stopButton.disabled=!0,this.stopButton.classList.add(c.DISABLED_BUTTON),this.api.startStopEngine(+a,e.STOPPED).then((()=>{cancelAnimationFrame(this.myReq),this.car.style.transform="translateX(0vw)",this.startButton.disabled=!1,this.startButton.classList.remove(c.DISABLED_BUTTON)}))}animateCar(e,t){const a=e*(window.screen.width/100);let n=this.car.offsetLeft;const s=t/1e3*60,i=(a-this.car.offsetLeft)/s,r=()=>{n+=i,this.car.style.transform=`translate(${n}px)`,n<a&&(this.myReq=requestAnimationFrame(r))};r()}async driveCar(t,a){window.matchMedia("(max-width: 700px)").matches?this.animateCar(60,a):this.animateCar(82,a),await this.api.driveCar(t,e.DRIVE).then((e=>{switch(!0){case!0===e.success:{this.observer.notify(i.FINISH,t);const e=this.formView.getAbsoluteWinner();this.api.getWinner(e).then((e=>{switch(!0){case e instanceof Object:this.api.updateWinner(t,{wins:e.wins+1,time:e.time});break;case 404===e:this.api.createWinner({id:t,wins:1,time:a});break;default:console.log("getWinner default error")}}));break}case 500===e:console.log("error 500"),cancelAnimationFrame(this.myReq);break;case 400===e:console.log("error 400");break;case 404===e:console.log("error 404");break;case 429===e:console.log("error 429");break;default:console.log("driveCar default error")}})).finally((()=>{this.startButton.disabled=!1,this.startButton.classList.remove(c.DISABLED_BUTTON),this.observer.notify(i.ARRAIVED)}))}}class R extends m{constructor(e){super(),this.pagination=this.createTagElement(r.BLOCK,[u.PAGINATION]),this.garageView=e}createButtons(e,t,a){this.pagination.innerHTML="";const n=Math.ceil(+e/a);for(let e=1;e<=n;e++){const a=this.createTagElement(r.BLOCK,[u.PAGE_BUTTON,c.BUTTON],e.toString());a.setAttribute(g.ID,`${e}`),a.addEventListener("click",(()=>this.choosePage(e,t))),this.pagination.append(a)}return this.pagination}choosePage(e,t){const a=localStorage.getItem(p.IS_GARAGE);"true"===a&&(localStorage.setItem(p.CURRENT_PAGE,e.toString()),this.garageView.createRaceRoad()),"false"===a&&(localStorage.setItem(p.CURRENT_WINNERS_PAGE,e.toString()),null!==t&&t.createWinnersTable())}}const N=["Acura","Alfa Romeo","Alpina","Asia","Aston Martin","Audi","Bentley","BMW","Brilliance","Bugatti","Buick","BYD","Cadillac","Changan","Chery","Chevrolet","Chrysler","Citroen","Dacia","Daewoo","Daihatsu","Datsun","DeLorean","Derways","Dodge","Dongfeng","FAW","Ferrari","Fiat","Ford","Foton","Freightliner","Geely","Genesis","GMC","Great Wall","Hafei","Haima","Haval","Hawtai","Hino","Honda","Hummer","Hyundai","Infiniti","Iran Khodro","Isuzu","JAC","Jaguar","Jeep","Kia","Koenigsegg","Lamborghini","Lancia","Land Rover","Lexus","Lifan","Lincoln","Lotus","Luxgen","Marussia","Maserati","Maybach","Mazda","McLaren","Mercedes-Benz","Mercury","MINI","Mitsubishi","Mitsuoka","Nissan","Oldsmobile","Opel","Pagani","Peugeot","Plymouth","Pontiac","Porsche"],B=["Sedan","coupe","hatchback","liftback","fastback","station wagon","crossover","SUV","Pickup","light van","Minivan","compact van","Microvan","Cabriolet","Roadster","Targa","Landau","Limousine"],C="GENERATE CARS";class b extends m{constructor(e,t){super(),this.form=this.createTagElement(r.FORM,[E.FORM]),this.inputCreateName=this.createTagElement(r.INPUT,[E.CREATE_NAME]),this.inputUpdateName=this.createTagElement(r.INPUT,[E.UPDATE_NAME]),this.buttonCreateColor=this.createTagElement(r.INPUT,[E.CREATE_COLOR]),this.buttonUpdateColor=this.createTagElement(r.INPUT,[E.UPDATE_COLOR]),this.buttonCreate=this.createTagElement(r.BUTTON,[E.BUTTON_CREATE,c.BUTTON],"CREATE"),this.buttonUpdate=this.createTagElement(r.BUTTON,[E.BUTTON_UPDATE,c.BUTTON],"UPDATE"),this.buttonRace=this.createTagElement(r.BUTTON,[E.BUTTON_RACE,c.BUTTON],"RACE"),this.buttonReset=this.createTagElement(r.BUTTON,[E.BUTTON_RESET,c.BUTTON],"RESET"),this.buttonGenerateCars=this.createTagElement(r.BUTTON,[E.GENERATE_CARS,c.BUTTON],C),this.winnerPopup=this.createTagElement(r.BLOCK,[E.WINNER_POPUP,E.GROW]),this.api=new n,this.winnerIds=[],this.countArrived=0,this.raceHandler=e=>{this.winnerIds=[],e.preventDefault(),this.observer.notify(i.RACE),this.observer?.subscribe(i.FINISH,this.setWinner.bind(this)),this.buttonRace.disabled=!0,this.buttonRace.classList.add(c.DISABLED_BUTTON)},this.unBlockRaceButton=async()=>{this.countArrived+=1;const e=localStorage.getItem(p.CURRENT_PAGE)||"1",t=(await this.api.getCarsByPage(+e)).length;this.countArrived>=t&&(this.buttonRace.disabled=!1,this.buttonRace.classList.remove(c.DISABLED_BUTTON),this.observer?.unsubscribe(i.ARRAIVED),this.countArrived=0)},this.resetHandler=e=>{this.winnerIds=[],this.countArrived=0,e.preventDefault(),this.observer.notify(i.RESET),document.body.contains(this.winnerPopup)&&document.body.removeChild(this.winnerPopup),this.buttonRace.disabled=!1,this.buttonRace.classList.remove(c.DISABLED_BUTTON),this.unBlockRaceButton()},this.observer=t,this.garageView=e,this.createForm(),this.sendFormData(),this.resetRace(),this.startRace()}createForm(){return this.buttonCreateColor.setAttribute(g.TYPE,"color"),this.buttonUpdateColor.setAttribute(g.TYPE,"color"),this.buttonCreateColor.setAttribute(g.VALUE,"#0000ff"),this.buttonUpdateColor.setAttribute(g.VALUE,"#0000ff"),this.form.append(this.inputCreateName,this.buttonCreateColor,this.buttonCreate,this.inputUpdateName,this.buttonUpdateColor,this.buttonUpdate,this.buttonRace,this.buttonReset,this.buttonGenerateCars),this.form}sendFormData(){this.buttonCreate.addEventListener("click",(e=>{e.preventDefault();const t=this.inputCreateName.value||"Car",a=this.buttonCreateColor.value;this.api.createCar({name:t,color:a}),this.garageView.createRaceRoad()})),this.buttonUpdate.addEventListener("click",(e=>{e.preventDefault();const t=localStorage.getItem(p.ID),a=this.inputUpdateName.value,n=this.buttonUpdateColor.value;t&&a&&this.api.updateCar(+t,{name:a,color:n}),this.garageView.createRaceRoad()})),this.buttonGenerateCars.addEventListener("click",(async e=>{e.preventDefault(),this.buttonGenerateCars.disabled=!0,this.buttonGenerateCars.classList.add(c.DISABLED_BUTTON),this.buttonGenerateCars.innerHTML="LOADING ...";for(let e=0;e<100;e++){const e=`${N[this.getRandomInt(N.length)]} ${B[this.getRandomInt(B.length)]}`,t="#"+(Math.random().toString(16)+"000000").substring(2,8).toUpperCase();await this.api.createCar({name:e,color:t})}this.garageView.createRaceRoad(),this.buttonGenerateCars.disabled=!1,this.buttonGenerateCars.classList.remove(c.DISABLED_BUTTON),this.buttonGenerateCars.innerHTML=C}))}startRace(){this.buttonRace.addEventListener("click",this.raceHandler)}resetRace(){this.buttonReset.addEventListener("click",this.resetHandler)}setItemName(e){this.inputUpdateName.value=e}getRandomInt(e){return Math.floor(Math.random()*e)}setWinner(e){this.winnerIds.push(+e),this.observer?.unsubscribe(i.FINISH),this.showWinnerPopup(this.winnerIds[0])}showWinnerPopup(e){this.winnerPopup.innerHTML="",this.api.getCar(e).then((e=>{const t=this.createTagElement(r.HEADER_SECOND,[E.WINNER_MESSAGE],`${e.name} WON!`);this.winnerPopup.append(t),document.body.append(this.winnerPopup)})),document.body.addEventListener("click",(()=>{document.body.contains(this.winnerPopup)&&document.body.removeChild(this.winnerPopup)}))}getAbsoluteWinner(){return this.winnerIds[0]}}class L extends m{constructor(e){super(),this.raceRoads=this.createTagElement(r.BLOCK,[d.RACE_ROAD]),this.carsListElement=this.createTagElement(r.BLOCK,[d.CAR_LIST],""),this.pageNumberHeader=this.createTagElement(r.HEADER_THIRD,[]),this.roadHeader=this.createTagElement(r.HEADER_SECOND,[]),this.api=new n,this.carViews=[],this.paginationView=new R(this),this.allCars=new Array(4),this.observer=e,this.garageView=this.createGarage(),this.formView=new b(this,this.observer),e?.subscribe(i.RACE,this.raceAllCars.bind(this))}getGarageView(){return this.garageView}createGarage(){const e=this.createTagElement(r.BLOCK,[d.GARAGE]),t=localStorage.getItem(p.IS_GARAGE);return"true"!==t&&t||(e.classList.add(c.SHOW),e.classList.remove(c.HIDE)),"false"===t&&(e.classList.remove(c.SHOW),e.classList.add(c.HIDE)),this.api.getAllCars().then((t=>(e.append(this.formView.createForm(),this.raceRoads,this.paginationView.createButtons(`${t.length}`,null,7)),this.createRaceRoad(),e))).then((e=>e)).catch((()=>alert("Server Error - failed to get cars"))),e}async createRaceRoad(){const e=localStorage.getItem(p.CURRENT_PAGE)||"1";this.carViews=[],this.carsListElement.innerHTML="",this.allCars.length,this.api.getAllCars().then((e=>{this.allCars=e,this.paginationView.createButtons(`${this.allCars.length}`,null,7),this.roadHeader.innerText=`Garage (${e.length})`})),this.pageNumberHeader.innerText=`Page #${e}`,this.raceRoads.append(this.roadHeader,this.pageNumberHeader,this.carsListElement),(await this.api.getCarsByPage(+e)).map((e=>{this.carView=new A(e,this.formView,this,this.observer),this.carViews.push(this.carView)})),this.carViews.map((e=>e.createCarBlock(this.carsListElement)))}showGarage(){this.garageView.classList.add(c.SHOW),this.garageView.classList.remove(c.HIDE)}hideGarage(){this.garageView.classList.remove(c.SHOW),this.garageView.classList.add(c.HIDE)}raceAllCars(){this.carViews.map((e=>e.startEngine(e.carData.id)))}}class O extends m{constructor(e,t){super(),this.toGarageButton=this.createTagElement(r.BUTTON,[l.TO_GARAGE,c.BUTTON],"TO GARAGE"),this.toWinnersButton=this.createTagElement(r.BUTTON,[l.TO_WINNERS,c.BUTTON],"TO WINNERS"),this.headerView=this.createHeader(),this.garageView=e,this.winnersView=t}getHeaderView(){return this.headerView}createHeader(){const e=this.createTagElement(r.HEADER,[l.HEADER]),t=this.createTagElement(r.BLOCK,[l.HEADER_BUTTONS]);return t.append(this.toGarageButton,this.toWinnersButton),e.append(t),this.showGarage(),this.showWinners(),e}showGarage(){this.toGarageButton.addEventListener("click",(()=>{this.garageView.showGarage(),this.winnersView.hideWinners(),localStorage.setItem(p.IS_GARAGE,"true")}))}showWinners(){this.toWinnersButton.addEventListener("click",(()=>{this.garageView.hideGarage(),this.winnersView.showWinners(),this.winnersView.createWinnersTable(),localStorage.setItem(p.IS_GARAGE,"false")}))}}class w extends m{constructor(e){super(),this.api=new n,this.winners=this.createTagElement(r.BLOCK,[T.WINNERS,c.HIDE]),this.table=this.createTagElement(r.BLOCK,[T.WINNERS_TABLE]),this.winnerHeader=this.createTagElement(r.HEADER_SECOND,[]),this.pageNumberHeader=this.createTagElement(r.HEADER_THIRD,[]),this.tableHeaderNum=this.createTagElement(r.BLOCK,[T.TABLE_HEADER_NUMBER,T.CELL,c.BUTTON],"Number"),this.tableHeaderCar=this.createTagElement(r.BLOCK,[T.TABLE_HEADER_CAR,T.CELL,c.BUTTON],"Car"),this.tableHeaderName=this.createTagElement(r.BLOCK,[T.TABLE_HEADER_NAME,T.CELL,c.BUTTON],"Name"),this.tableHeaderWins=this.createTagElement(r.BLOCK,[T.TABLE_HEADER_WINS,T.CELL,c.BUTTON],"Wins  &darr;"),this.tableHeaderTime=this.createTagElement(r.BLOCK,[T.TABLE_HEADER_TIME,T.CELL,c.BUTTON],"Best time &uarr;"),this.winnersView=this.createWinnersPage(),this.paginationView=e}getWinnersView(){return this.winnersView}createWinnersPage(){const e=localStorage.getItem(p.IS_GARAGE);return"true"!==e&&e||this.hideWinners(),"false"===e&&this.showWinners(),this.createWinnersTable(),this.sortByID(),this.sortByTyme(),this.sortByWins(),this.winners}createWinnersTable(t=e.ID,a=e.ASC){const n=localStorage.getItem(p.CURRENT_WINNERS_PAGE)||"1";this.table.innerHTML="",this.pageNumberHeader.innerText=`Page #${n}`,this.createTableHeaders(this.table),this.api.getWinnersByPage(+n,10,t,a).then((e=>{e&&e.map(((e,t)=>{const a=this.createTagElement(r.BLOCK,[T.WINNER_ROW]),i=this.createTagElement(r.BLOCK,[T.WINNER_NUM,T.CELL],`${10*(+n-1)+t+1}`),o=this.createTagElement(r.BLOCK,[T.WINNER_WINS,T.CELL],`${e.wins}`),c=this.createTagElement(r.BLOCK,[T.WINNER_TIME,T.CELL],`${Math.round(e.time)}`);this.api.getCar(e.id).then((e=>{const t=this.createTagElement(r.BLOCK,[T.WINNER_CAR,T.CELL]);t.innerHTML=s;const n=t.querySelector(h.SVG);n&&n.setAttribute(g.FILL,`${e.color}`);const l=this.createTagElement(r.BLOCK,[T.WINNER_NAME,T.CELL],`${e.name}`);a.append(i,t,l,o,c)})),this.table.append(a)}))})).catch((()=>console.log("no winners"))),this.api.getAllWinners().then((e=>{e&&(this.winnerHeader.innerText=`Winners (${e.length})`,this.winners.append(this.winnerHeader,this.pageNumberHeader,this.table,this.paginationView.createButtons(`${e.length}`,this,10)))})).catch((()=>console.log("no winners")))}createTableHeaders(e){const t=this.createTagElement(r.BLOCK,[T.WINNER_ROW,T.TABLE_HEADER]);t.append(this.tableHeaderNum,this.tableHeaderCar,this.tableHeaderName,this.tableHeaderWins,this.tableHeaderTime),e.append(t)}showWinners(){this.winners.classList.add(c.SHOW),this.winners.classList.remove(c.HIDE),localStorage.setItem(p.IS_GARAGE,"false")}hideWinners(){this.winners.classList.remove(c.SHOW),this.winners.classList.add(c.HIDE),localStorage.setItem(p.IS_GARAGE,"true")}sortByID(){this.tableHeaderNum.addEventListener("click",(()=>this.createWinnersTable(e.ID,e.ASC)))}sortByWins(){this.tableHeaderWins.addEventListener("click",(()=>this.createWinnersTable(e.WINS,e.DESC)))}sortByTyme(){this.tableHeaderTime.addEventListener("click",(()=>this.createWinnersTable(e.TYME,e.ASC)))}}class I{constructor(){this.listeners=new Map}subscribe(e,t){let a=this.listeners.get(e);a||(a=new Array,this.listeners.set(e,a)),a.push(t)}unsubscribe(e){this.listeners.delete(e)}notify(e,t){const a=this.listeners.get(e);a&&a.forEach((e=>e(t)))}}new class{constructor(){this.createApp()}createApp(){const e=document.createElement(r.BLOCK);e.classList.add(o.APP);const t=new I,a=new L(t),n=new R(a),s=new w(n),i=new O(a,s);e.append(i.getHeaderView(),a.getGarageView(),s.getWinnersView()),document.body.append(e)}}})();